(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,r)=>{t.exports=e.r(76562)},54858,e=>{"use strict";async function t(e,r={}){let l=localStorage.getItem("token"),s={"Content-Type":"application/json",...r.headers};l&&(s.Authorization=`Bearer ${l}`);let a=e.startsWith("/")?e:`/${e}`,n=await fetch(`https://zhuyin-battle.marmot0814.com${a}`,{...r,headers:s});return(401===n.status||403===n.status)&&(localStorage.removeItem("token"),localStorage.removeItem("user"),"/"!==window.location.pathname&&"/lobby"!==window.location.pathname&&(window.location.href="/")),n}e.s(["api",()=>t])},16947,e=>{"use strict";var t=e.i(43476),r=e.i(932),l=e.i(71645),s=e.i(18566),a=e.i(54858);let n=l.default.memo(e=>{let s,a,n,i,o,d,c=(0,r.c)(21),{tile:u,isHovered:h,isSelected:x,onMouseEnter:m,onMouseLeave:f,onClick:b}=e,[p,g]=(0,l.useState)(!1),y=(0,l.useRef)(u);c[0]!==u?(s=()=>{if(y.current.state!==u.state||y.current.phonetic!==u.phonetic){g(!0);let e=setTimeout(()=>g(!1),300);return()=>clearTimeout(e)}y.current=u},c[0]=u,c[1]=s):s=c[1],c[2]!==u.phonetic||c[3]!==u.state?(a=[u.state,u.phonetic],c[2]=u.phonetic,c[3]=u.state,c[4]=a):a=c[4],(0,l.useEffect)(s,a);let v=u.state,w="linear-gradient(180deg, #cbd5e1 0%, #94a3b8 100%)";"red_castle"===v||"red_territory"===v?w="linear-gradient(180deg,#fca5a5,#ef4444)":("blue_castle"===v||"blue_territory"===v)&&(w="linear-gradient(180deg,#93c5fd,#3b82f6)"),x&&(w="linear-gradient(180deg, #fbbf24, #d97706)");let j=`hex-tile relative transition-all duration-500 cursor-pointer ${p||x?"z-10":"z-0"}`,N=h||x?"0 12px 24px rgba(2,6,23,0.3), inset 0 8px 16px rgba(255,255,255,0.12)":"0 4px 8px rgba(2,6,23,0.08), inset 0 4px 8px rgba(255,255,255,0.04)",S=h?"brightness(1.15)":"brightness(1)",k=p?"scale(1.1)":"scale(1)";return c[5]!==w||c[6]!==N||c[7]!==S||c[8]!==k?(n={width:"var(--hex-size)",paddingBottom:"calc(var(--hex-size) * 1.1547)",marginLeft:"calc(var(--hex-size) * 0.05)",clipPath:"polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%)",background:w,boxShadow:N,filter:S,transform:k},c[5]=w,c[6]=N,c[7]=S,c[8]=k,c[9]=n):n=c[9],c[10]===Symbol.for("react.memo_cache_sentinel")?(i=(0,t.jsx)("div",{className:"absolute inset-0 border border-slate-200/60"}),c[10]=i):i=c[10],c[11]!==u.phonetic||c[12]!==v?(o="red_castle"===v||"blue_castle"===v?(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center z-30 animate-in zoom-in duration-300",children:(0,t.jsx)("span",{style:{fontSize:30,lineHeight:1},children:"ðŸ°"})}):"white_phonetic"===v&&u.phonetic?(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center z-30 animate-in zoom-in duration-300",children:(0,t.jsx)("div",{style:{fontSize:30,color:"#0f172a",fontWeight:700},children:u.phonetic})},u.phonetic):null,c[11]=u.phonetic,c[12]=v,c[13]=o):o=c[13],c[14]!==b||c[15]!==m||c[16]!==f||c[17]!==j||c[18]!==n||c[19]!==o?(d=(0,t.jsxs)("div",{role:"button",onMouseEnter:m,onMouseLeave:f,onClick:b,className:j,style:n,children:[i,o]}),c[14]=b,c[15]=m,c[16]=f,c[17]=j,c[18]=n,c[19]=o,c[20]=d):d=c[20],d});function i(){let e=(0,s.useRouter)(),r=(0,s.useSearchParams)().get("id"),[i,o]=(0,l.useState)(null),[d,c]=(0,l.useState)([]),[u,h]=(0,l.useState)(null),[x,m]=(0,l.useState)(!1),[f,b]=(0,l.useState)(null),[p,g]=(0,l.useState)(null),y=(0,l.useRef)(null),v=(0,l.useRef)(!1),w=(0,l.useRef)({x:0,y:0}),[j,N]=(0,l.useState)(1),[S,k]=(0,l.useState)(0),[I,$]=(0,l.useState)(0),_=e=>{let t=Math.floor(e/3600),r=Math.floor(e%3600/60),l=e%60;return t>0?`${t}:${r.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`:`${r}:${l.toString().padStart(2,"0")}`};async function M(){if(i&&i.isMyTurn)try{let e=await (0,a.api)(`/api/game/${r}/skill`,{method:"POST"});if(!e.ok){let t=await e.json();h(t.error),setTimeout(()=>h(null),3e3)}}catch(e){console.error(e)}}(0,l.useEffect)(()=>{if(!r)return;let e=async()=>{try{let e=await (0,a.api)(`/api/game/${r}`);if(e.ok){let t=await e.json();if(o(t),"finished"===t.status&&!f){let e=t.winner===t.player1Id?t.player1Name:t.player2Name;t.winner===t.player1Id&&t.player1Id===t.turn||t.winner===t.player1Id&&t.isMyTurn;let r=t.winner===t.currentUserId;b({winnerName:e,isWinner:r})}}else console.error("Failed to fetch game state")}catch(e){console.error(e)}};e();let t=setInterval(e,1e3);return()=>clearInterval(t)},[r,e,f]);let T=(0,l.useCallback)(e=>{if(!y.current)return;e.preventDefault();let t=y.current.getBoundingClientRect(),r=e.clientX-t.left,l=e.clientY-t.top,s=Math.exp(-(.015*e.deltaY));N(e=>{let t=Math.max(.5,Math.min(3,e*s));return k(l=>r-t/e*(r-l)),$(r=>l-t/e*(l-r)),t})},[]);function C(e){try{e.target.releasePointerCapture(e.pointerId)}catch{}v.current=!1}async function z(){if(0!==d.length){m(!0);try{let e=await (0,a.api)(`/api/game/${r}/move`,{method:"POST",body:JSON.stringify({sequence:d.map(e=>({r:e.r,c:e.c}))})}),t=await e.json();e.ok?c([]):(h(t.error),setTimeout(()=>h(null),3e3))}catch(e){console.error(e)}finally{m(!1)}}}if((0,l.useEffect)(()=>{let e=y.current;if(e)return e.addEventListener("wheel",T,{passive:!1}),()=>e.removeEventListener("wheel",T)},[T]),(0,l.useEffect)(()=>{if(!y.current)return;let e=y.current.querySelector(".hex-map-inner");if(!e)return;let t=()=>{let t=y.current.offsetWidth,r=y.current.offsetHeight,l=e.offsetWidth,s=e.offsetHeight;t>0&&r>0&&l>0&&s>0&&(k((t-l)/2),$((r-s)/2))},r=setTimeout(t,100),l=new ResizeObserver(t);return l.observe(y.current),()=>{clearTimeout(r),l.disconnect()}},[]),!i)return(0,t.jsx)("div",{className:"flex items-center justify-center h-screen bg-[#071029] text-white",children:"Loading game..."});let P=i.board;return(0,t.jsxs)("div",{className:"flex h-screen bg-[#071029] text-slate-200 relative",children:[f&&(0,t.jsx)("div",{className:"absolute inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-md animate-in fade-in duration-500",children:(0,t.jsxs)("div",{className:"text-center p-12 rounded-3xl bg-slate-900/90 border border-slate-700 shadow-2xl max-w-2xl w-full mx-4 transform transition-all scale-100",children:[(0,t.jsx)("div",{className:"mb-6 text-8xl animate-bounce",children:f.isWinner?"ðŸ†":"ðŸ’€"}),(0,t.jsx)("h1",{className:`text-6xl font-black mb-4 tracking-tight ${f.isWinner?"text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 drop-shadow-[0_0_15px_rgba(234,179,8,0.5)]":"text-slate-400"}`,children:f.isWinner?"VICTORY":"DEFEAT"}),(0,t.jsxs)("p",{className:"text-2xl text-slate-300 mb-8 font-light",children:["Winner: ",(0,t.jsx)("span",{className:"font-bold text-white",children:f.winnerName})]}),(0,t.jsx)("button",{onClick:()=>e.push("/lobby"),className:"px-10 py-4 bg-indigo-600 hover:bg-indigo-500 text-white text-xl font-bold rounded-xl shadow-lg hover:shadow-indigo-500/25 transition-all transform hover:-translate-y-1 active:translate-y-0",children:"Back to Lobby"})]})}),(0,t.jsxs)("div",{className:"flex-1 overflow-hidden relative",children:[(0,t.jsx)("button",{onClick:function(){N(1),k(0),$(0),setTimeout(()=>{if(!y.current)return;let e=y.current.querySelector(".hex-map-inner");if(!e)return;let t=y.current.offsetWidth,r=y.current.offsetHeight,l=e.offsetWidth,s=e.offsetHeight;t>0&&r>0&&l>0&&s>0&&(k((t-l)/2),$((r-s)/2))},50)},className:"absolute top-4 left-4 z-50 bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded-lg text-white text-sm font-medium transition",children:"ðŸ”„ é‡ç½®è¦–è§’"}),u&&(0,t.jsx)("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-50 bg-red-500/90 text-white px-6 py-3 rounded-xl shadow-xl animate-bounce",children:u}),i&&(0,t.jsxs)("div",{className:"absolute bottom-8 left-8 z-50 flex flex-col items-center gap-2",children:[(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)("button",{onClick:M,disabled:!i.isMyTurn||1>(i.skillInventory?.[i.currentUserId]||0),className:`w-16 h-16 rounded-full flex items-center justify-center text-2xl shadow-lg transition-all transform active:scale-95 border-4 ${(i.skillInventory?.[i.currentUserId]||0)>0?"bg-purple-600 hover:bg-purple-500 border-purple-400 text-white cursor-pointer animate-pulse":"bg-slate-800 border-slate-600 text-slate-500 cursor-not-allowed"}`,title:"Shuffle Board (Cost: 1 Skill Item)",children:"ðŸŽ²"}),(0,t.jsx)("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold w-6 h-6 rounded-full flex items-center justify-center border-2 border-slate-900",children:i.skillInventory?.[i.currentUserId]||0})]}),(0,t.jsx)("div",{className:"w-20 h-2 bg-slate-800 rounded-full overflow-hidden border border-slate-700",children:(0,t.jsx)("div",{className:"h-full bg-yellow-400 transition-all duration-500",style:{width:`${(i.skillCharges?.[i.currentUserId]||0)/3*100}%`}})}),(0,t.jsxs)("div",{className:"text-xs text-slate-400 font-mono bg-slate-900/50 px-2 py-1 rounded",children:["Charge: ",i.skillCharges?.[i.currentUserId]||0,"/3"]})]}),(0,t.jsx)("div",{className:"hex-map h-full overflow-hidden",ref:y,onPointerDown:function(e){if(y.current){try{e.target.setPointerCapture(e.pointerId)}catch{}v.current=!0,w.current={x:e.clientX,y:e.clientY}}},onPointerMove:function(e){if(!v.current)return;let t=e.clientX-w.current.x,r=e.clientY-w.current.y;w.current={x:e.clientX,y:e.clientY},k(e=>e+t),$(e=>e+r)},onPointerUp:C,onPointerCancel:C,style:{"--hex-size":"72px"},children:(0,t.jsx)("div",{className:"hex-map-inner",style:{transform:`translate(${S}px, ${I}px) scale(${j})`,transformOrigin:"0 0"},children:P.map((e,r)=>(0,t.jsx)("div",{className:"hex-row flex gap-0",style:{marginBottom:"calc(var(--hex-size) * -0.25)",...r%2==1?{marginLeft:"calc(var(--hex-size) * 0.53)"}:{}},children:e.map((e,l)=>{let s=`${r},${l}`,a=p===s,o=d.some(e=>e.r===r&&e.c===l);return(0,t.jsx)(n,{tile:e,isHovered:a,isSelected:o,onMouseEnter:()=>g(s),onMouseLeave:()=>g(null),onClick:()=>{var t;return t=e.phonetic,void(!i||!i.isMyTurn||!t||!d.some(e=>e.r===r&&e.c===l)&&c([...d,{r:r,c:l,phonetic:t}]))}},s)})},r))})})]}),(0,t.jsxs)("aside",{className:"w-96 h-screen bg-[#0b1422] border-l border-slate-800 p-6 flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsx)("h3",{className:"font-bold text-xl text-white",children:"ranked"===i.gameMode?"ç©åˆ†å°æˆ°":"ranked_rts"===i.gameMode?"å³æ™‚æˆ°ç•¥ (RTS)":"ä¸€èˆ¬å°æˆ°"}),(0,t.jsx)("button",{onClick:()=>e.push("/lobby"),className:"text-sm text-slate-400 hover:text-white",children:"é›¢é–‹"})]}),(0,t.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,t.jsxs)("div",{className:`p-4 rounded-xl border transition-all ${i.turn===i.player1Id?"bg-red-900/20 border-red-500 shadow-[0_0_15px_rgba(239,68,68,0.3)]":"bg-slate-800/50 border-slate-700"}`,children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)("span",{className:"font-bold text-red-400",children:i.player1Name||"Player 1"}),"ranked_rts"!==i.gameMode&&(0,t.jsx)("span",{className:`text-2xl font-mono font-bold ${i.timer[i.player1Id]<30?"text-red-500 animate-pulse":"text-white"}`,children:_(i.timer[i.player1Id])})]}),"ranked_rts"!==i.gameMode&&(0,t.jsx)("div",{className:"w-full bg-slate-700 h-2 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-red-500 transition-all duration-1000",style:{width:`${Math.min(i.timer[i.player1Id]/7200*100,100)}%`}})})]}),(0,t.jsxs)("div",{className:`p-4 rounded-xl border transition-all ${i.turn===i.player2Id?"bg-blue-900/20 border-blue-500 shadow-[0_0_15px_rgba(59,130,246,0.3)]":"bg-slate-800/50 border-slate-700"}`,children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)("span",{className:"font-bold text-blue-400",children:i.player2Name||"Player 2"}),"ranked_rts"!==i.gameMode&&(0,t.jsx)("span",{className:`text-2xl font-mono font-bold ${i.timer[i.player2Id]<30?"text-red-500 animate-pulse":"text-white"}`,children:_(i.timer[i.player2Id])})]}),"ranked_rts"!==i.gameMode&&(0,t.jsx)("div",{className:"w-full bg-slate-700 h-2 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-blue-500 transition-all duration-1000",style:{width:`${Math.min(i.timer[i.player2Id]/7200*100,100)}%`}})})]})]}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col bg-slate-900/50 rounded-xl p-4 border border-slate-800",children:[(0,t.jsx)("div",{className:"text-slate-400 text-sm mb-2",children:"ç•¶å‰è¼¸å…¥åºåˆ—ï¼š"}),(0,t.jsx)("div",{className:"flex-1 bg-slate-950 rounded-lg p-4 mb-4 flex items-center justify-center text-4xl font-bold tracking-widest text-yellow-400 border border-slate-800 shadow-inner",children:d.map(e=>e.phonetic).join("")||(0,t.jsx)("span",{className:"text-slate-700 text-2xl",children:"è«‹é»žæ“Šåœ°åœ–é¸æ“‡æ³¨éŸ³"})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[(0,t.jsx)("button",{onClick:function(){c(e=>e.slice(0,-1))},disabled:0===d.length,className:"bg-slate-700 hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed text-white py-3 rounded-lg font-bold transition-colors",children:"âŒ« é€€æ ¼"}),(0,t.jsx)("button",{onClick:function(){c([])},disabled:0===d.length,className:"bg-red-900/50 hover:bg-red-800/50 disabled:opacity-50 disabled:cursor-not-allowed text-red-200 py-3 rounded-lg font-bold transition-colors border border-red-900",children:"ðŸ—‘ï¸ æ¸…ç©º"})]}),(0,t.jsx)("button",{onClick:z,disabled:!i.isMyTurn||0===d.length||x,className:`w-full py-4 rounded-xl font-bold text-xl shadow-lg transition-all transform active:scale-95 ${i.isMyTurn?"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white":"bg-slate-800 text-slate-500 cursor-not-allowed"}`,children:x?"é©—è­‰ä¸­...":i.isMyTurn?"ç¢ºèªé€å‡º (Enter)":"ç­‰å¾…å°æ‰‹è¡Œå‹•..."})]}),(0,t.jsx)("div",{className:"mt-4 h-32 overflow-y-auto bg-slate-950 rounded-lg p-3 text-xs space-y-1 font-mono border border-slate-800",children:i.logs.slice().reverse().map((e,r)=>(0,t.jsx)("div",{className:"text-slate-400 border-b border-slate-800/50 pb-1 last:border-0",children:e},r))})]})]})}function o(){let e,s=(0,r.c)(1);return s[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,t.jsx)(l.Suspense,{fallback:(0,t.jsx)("div",{className:"flex items-center justify-center h-screen bg-[#071029] text-white",children:"Loading battle..."}),children:(0,t.jsx)(i,{})}),s[0]=e):e=s[0],e}e.s(["default",()=>o])}]);