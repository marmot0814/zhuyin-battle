(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,r)=>{t.exports=e.r(76562)},54858,e=>{"use strict";async function t(e,r={}){let l=localStorage.getItem("token"),s={"Content-Type":"application/json",...r.headers};l&&(s.Authorization=`Bearer ${l}`);let a=e.startsWith("/")?e:`/${e}`,n=await fetch(`https://zhuyin-battle.marmot0814.com${a}`,{...r,headers:s});return(401===n.status||403===n.status)&&(localStorage.removeItem("token"),localStorage.removeItem("user"),"/"!==window.location.pathname&&"/lobby"!==window.location.pathname&&(window.location.href="/")),n}e.s(["api",()=>t])},16947,e=>{"use strict";var t=e.i(43476),r=e.i(932),l=e.i(71645),s=e.i(18566),a=e.i(54858);function n(){let e=(0,s.useRouter)(),r=(0,s.useSearchParams)().get("id"),[n,i]=(0,l.useState)(null),[o,d]=(0,l.useState)([]),[c,u]=(0,l.useState)(null),[x,h]=(0,l.useState)(!1),[b,m]=(0,l.useState)(null),[f,p]=(0,l.useState)(null),g=(0,l.useRef)(null),y=(0,l.useRef)(!1),v=(0,l.useRef)({x:0,y:0}),[w,j]=(0,l.useState)(1),[N,I]=(0,l.useState)(0),[k,S]=(0,l.useState)(0);async function T(){if(n&&n.isMyTurn)try{let e=await (0,a.api)(`/api/game/${r}/skill`,{method:"POST"});if(!e.ok){let t=await e.json();u(t.error),setTimeout(()=>u(null),3e3)}}catch(e){console.error(e)}}(0,l.useEffect)(()=>{if(!r)return;let e=async()=>{try{let e=await (0,a.api)(`/api/game/${r}`);if(e.ok){let t=await e.json();if(i(t),"finished"===t.status&&!b){let e=t.winner===t.player1Id?t.player1Name:t.player2Name;t.winner===t.player1Id&&t.player1Id===t.turn||t.winner===t.player1Id&&t.isMyTurn;let r=-1;r=t.isMyTurn?t.turn:t.turn===t.player1Id?t.player2Id:t.player1Id;let l=t.winner===r;m({winnerName:e,isWinner:l})}}else console.error("Failed to fetch game state")}catch(e){console.error(e)}};e();let t=setInterval(e,1e3);return()=>clearInterval(t)},[r,e,b]);let C=(0,l.useCallback)(e=>{if(!g.current)return;e.preventDefault();let t=g.current.getBoundingClientRect(),r=e.clientX-t.left,l=e.clientY-t.top,s=Math.exp(-(.015*e.deltaY));j(e=>{let t=Math.max(.5,Math.min(3,e*s));return I(l=>r-t/e*(r-l)),S(r=>l-t/e*(l-r)),t})},[]);function $(e){try{e.target.releasePointerCapture(e.pointerId)}catch{}y.current=!1}async function _(){if(0!==o.length){h(!0);try{let e=await (0,a.api)(`/api/game/${r}/move`,{method:"POST",body:JSON.stringify({sequence:o.map(e=>({r:e.r,c:e.c}))})}),t=await e.json();e.ok?d([]):(u(t.error),setTimeout(()=>u(null),3e3))}catch(e){console.error(e)}finally{h(!1)}}}if((0,l.useEffect)(()=>{let e=g.current;if(e)return e.addEventListener("wheel",C,{passive:!1}),()=>e.removeEventListener("wheel",C)},[C]),(0,l.useEffect)(()=>{if(!g.current)return;let e=g.current.querySelector(".hex-map-inner");if(!e)return;let t=()=>{let t=g.current.offsetWidth,r=g.current.offsetHeight,l=e.offsetWidth,s=e.offsetHeight;t>0&&r>0&&l>0&&s>0&&(I((t-l)/2),S((r-s)/2))},r=setTimeout(t,100),l=new ResizeObserver(t);return l.observe(g.current),()=>{clearTimeout(r),l.disconnect()}},[]),!n)return(0,t.jsx)("div",{className:"flex items-center justify-center h-screen bg-[#071029] text-white",children:"Loading game..."});let z=n.board;return(0,t.jsxs)("div",{className:"flex h-screen bg-[#071029] text-slate-200 relative",children:[b&&(0,t.jsx)("div",{className:"absolute inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-md animate-in fade-in duration-500",children:(0,t.jsxs)("div",{className:"text-center p-12 rounded-3xl bg-slate-900/90 border border-slate-700 shadow-2xl max-w-2xl w-full mx-4 transform transition-all scale-100",children:[(0,t.jsx)("div",{className:"mb-6 text-8xl animate-bounce",children:b.isWinner?"ðŸ†":"ðŸ’€"}),(0,t.jsx)("h1",{className:`text-6xl font-black mb-4 tracking-tight ${b.isWinner?"text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 drop-shadow-[0_0_15px_rgba(234,179,8,0.5)]":"text-slate-400"}`,children:b.isWinner?"VICTORY":"DEFEAT"}),(0,t.jsxs)("p",{className:"text-2xl text-slate-300 mb-8 font-light",children:["Winner: ",(0,t.jsx)("span",{className:"font-bold text-white",children:b.winnerName})]}),(0,t.jsx)("button",{onClick:()=>e.push("/lobby"),className:"px-10 py-4 bg-indigo-600 hover:bg-indigo-500 text-white text-xl font-bold rounded-xl shadow-lg hover:shadow-indigo-500/25 transition-all transform hover:-translate-y-1 active:translate-y-0",children:"Back to Lobby"})]})}),(0,t.jsxs)("div",{className:"flex-1 overflow-hidden relative",children:[(0,t.jsx)("button",{onClick:function(){j(1),I(0),S(0),setTimeout(()=>{if(!g.current)return;let e=g.current.querySelector(".hex-map-inner");if(!e)return;let t=g.current.offsetWidth,r=g.current.offsetHeight,l=e.offsetWidth,s=e.offsetHeight;t>0&&r>0&&l>0&&s>0&&(I((t-l)/2),S((r-s)/2))},50)},className:"absolute top-4 left-4 z-50 bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded-lg text-white text-sm font-medium transition",children:"ðŸ”„ é‡ç½®è¦–è§’"}),c&&(0,t.jsx)("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-50 bg-red-500/90 text-white px-6 py-3 rounded-xl shadow-xl animate-bounce",children:c}),n&&(0,t.jsxs)("div",{className:"absolute bottom-8 left-8 z-50 flex flex-col items-center gap-2",children:[(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)("button",{onClick:T,disabled:!n.isMyTurn||1>(n.skillInventory?.[n.currentUserId]||0),className:`w-16 h-16 rounded-full flex items-center justify-center text-2xl shadow-lg transition-all transform active:scale-95 border-4 ${(n.skillInventory?.[n.currentUserId]||0)>0?"bg-purple-600 hover:bg-purple-500 border-purple-400 text-white cursor-pointer animate-pulse":"bg-slate-800 border-slate-600 text-slate-500 cursor-not-allowed"}`,title:"Shuffle Board (Cost: 1 Skill Item)",children:"ðŸŽ²"}),(0,t.jsx)("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold w-6 h-6 rounded-full flex items-center justify-center border-2 border-slate-900",children:n.skillInventory?.[n.currentUserId]||0})]}),(0,t.jsx)("div",{className:"w-20 h-2 bg-slate-800 rounded-full overflow-hidden border border-slate-700",children:(0,t.jsx)("div",{className:"h-full bg-yellow-400 transition-all duration-500",style:{width:`${(n.skillCharges?.[n.currentUserId]||0)/3*100}%`}})}),(0,t.jsxs)("div",{className:"text-xs text-slate-400 font-mono bg-slate-900/50 px-2 py-1 rounded",children:["Charge: ",n.skillCharges?.[n.currentUserId]||0,"/3"]})]}),(0,t.jsx)("div",{className:"hex-map h-full overflow-hidden",ref:g,onPointerDown:function(e){if(g.current){try{e.target.setPointerCapture(e.pointerId)}catch{}y.current=!0,v.current={x:e.clientX,y:e.clientY}}},onPointerMove:function(e){if(!y.current)return;let t=e.clientX-v.current.x,r=e.clientY-v.current.y;v.current={x:e.clientX,y:e.clientY},I(e=>e+t),S(e=>e+r)},onPointerUp:$,onPointerCancel:$,style:{"--hex-size":"72px"},children:(0,t.jsx)("div",{className:"hex-map-inner",style:{transform:`translate(${N}px, ${k}px) scale(${w})`,transformOrigin:"0 0"},children:z.map((e,r)=>(0,t.jsx)("div",{className:"hex-row flex gap-0",style:{marginBottom:"calc(var(--hex-size) * -0.25)",...r%2==1?{marginLeft:"calc(var(--hex-size) * 0.53)"}:{}},children:e.map((e,l)=>{let s=`${r},${l}`,a=f===s,i=o.some(e=>e.r===r&&e.c===l),c="linear-gradient(180deg, #cbd5e1 0%, #94a3b8 100%)";return("red_castle"===e.state||"red_territory"===e.state)&&(c="linear-gradient(180deg,#fca5a5,#ef4444)"),("blue_castle"===e.state||"blue_territory"===e.state)&&(c="linear-gradient(180deg,#93c5fd,#3b82f6)"),i&&(c="linear-gradient(180deg, #fbbf24, #d97706)"),(0,t.jsxs)("div",{role:"button",onMouseEnter:()=>p(s),onMouseLeave:()=>p(null),onClick:()=>{var t;return t=e.phonetic,void(!n||!n.isMyTurn||!t||!o.some(e=>e.r===r&&e.c===l)&&d([...o,{r:r,c:l,phonetic:t}]))},className:"hex-tile relative transition-all duration-150 cursor-pointer",style:{width:"var(--hex-size)",paddingBottom:"calc(var(--hex-size) * 1.1547)",marginLeft:"calc(var(--hex-size) * 0.05)",clipPath:"polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%)",background:c,boxShadow:a||i?"0 12px 24px rgba(2,6,23,0.3), inset 0 8px 16px rgba(255,255,255,0.12)":"0 4px 8px rgba(2,6,23,0.08), inset 0 4px 8px rgba(255,255,255,0.04)",filter:a?"brightness(1.15)":"brightness(1)",zIndex:i?10:1},children:[(0,t.jsx)("div",{className:"absolute inset-0 border border-slate-200/60"}),e.state.includes("castle")?(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center z-30 text-3xl",children:"ðŸ°"}):e.phonetic?(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center z-30 text-2xl font-bold text-slate-900",children:e.phonetic}):null]},s)})},r))})})]}),(0,t.jsxs)("aside",{className:"w-96 h-screen bg-[#0b1422] border-l border-slate-800 p-6 flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsx)("h3",{className:"font-bold text-xl text-white",children:"ranked"===n.gameMode?"ç©åˆ†å°æˆ°":"ä¸€èˆ¬å°æˆ°"}),(0,t.jsx)("button",{onClick:()=>e.push("/lobby"),className:"text-sm text-slate-400 hover:text-white",children:"é›¢é–‹"})]}),(0,t.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,t.jsxs)("div",{className:`p-4 rounded-xl border transition-all ${n.turn===n.player1Id?"bg-red-900/20 border-red-500 shadow-[0_0_15px_rgba(239,68,68,0.3)]":"bg-slate-800/50 border-slate-700"}`,children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)("span",{className:"font-bold text-red-400",children:n.player1Name||"Player 1"}),(0,t.jsxs)("span",{className:`text-2xl font-mono font-bold ${n.timer[n.player1Id]<30?"text-red-500 animate-pulse":"text-white"}`,children:[n.timer[n.player1Id],"s"]})]}),(0,t.jsx)("div",{className:"w-full bg-slate-700 h-2 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-red-500 transition-all duration-1000",style:{width:`${n.timer[n.player1Id]/120*100}%`}})})]}),(0,t.jsxs)("div",{className:`p-4 rounded-xl border transition-all ${n.turn===n.player2Id?"bg-blue-900/20 border-blue-500 shadow-[0_0_15px_rgba(59,130,246,0.3)]":"bg-slate-800/50 border-slate-700"}`,children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)("span",{className:"font-bold text-blue-400",children:n.player2Name||"Player 2"}),(0,t.jsxs)("span",{className:`text-2xl font-mono font-bold ${n.timer[n.player2Id]<30?"text-red-500 animate-pulse":"text-white"}`,children:[n.timer[n.player2Id],"s"]})]}),(0,t.jsx)("div",{className:"w-full bg-slate-700 h-2 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-blue-500 transition-all duration-1000",style:{width:`${n.timer[n.player2Id]/120*100}%`}})})]})]}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col bg-slate-900/50 rounded-xl p-4 border border-slate-800",children:[(0,t.jsx)("div",{className:"text-slate-400 text-sm mb-2",children:"ç•¶å‰è¼¸å…¥åºåˆ—ï¼š"}),(0,t.jsx)("div",{className:"flex-1 bg-slate-950 rounded-lg p-4 mb-4 flex items-center justify-center text-4xl font-bold tracking-widest text-yellow-400 border border-slate-800 shadow-inner",children:o.map(e=>e.phonetic).join("")||(0,t.jsx)("span",{className:"text-slate-700 text-2xl",children:"è«‹é»žæ“Šåœ°åœ–é¸æ“‡æ³¨éŸ³"})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[(0,t.jsx)("button",{onClick:function(){d(e=>e.slice(0,-1))},disabled:0===o.length,className:"bg-slate-700 hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed text-white py-3 rounded-lg font-bold transition-colors",children:"âŒ« é€€æ ¼"}),(0,t.jsx)("button",{onClick:function(){d([])},disabled:0===o.length,className:"bg-red-900/50 hover:bg-red-800/50 disabled:opacity-50 disabled:cursor-not-allowed text-red-200 py-3 rounded-lg font-bold transition-colors border border-red-900",children:"ðŸ—‘ï¸ æ¸…ç©º"})]}),(0,t.jsx)("button",{onClick:_,disabled:!n.isMyTurn||0===o.length||x,className:`w-full py-4 rounded-xl font-bold text-xl shadow-lg transition-all transform active:scale-95 ${n.isMyTurn?"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white":"bg-slate-800 text-slate-500 cursor-not-allowed"}`,children:x?"é©—è­‰ä¸­...":n.isMyTurn?"ç¢ºèªé€å‡º (Enter)":"ç­‰å¾…å°æ‰‹è¡Œå‹•..."})]}),(0,t.jsx)("div",{className:"mt-4 h-32 overflow-y-auto bg-slate-950 rounded-lg p-3 text-xs space-y-1 font-mono border border-slate-800",children:n.logs.slice().reverse().map((e,r)=>(0,t.jsx)("div",{className:"text-slate-400 border-b border-slate-800/50 pb-1 last:border-0",children:e},r))})]})]})}function i(){let e,s=(0,r.c)(1);return s[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,t.jsx)(l.Suspense,{fallback:(0,t.jsx)("div",{className:"flex items-center justify-center h-screen bg-[#071029] text-white",children:"Loading battle..."}),children:(0,t.jsx)(n,{})}),s[0]=e):e=s[0],e}e.s(["default",()=>i])}]);