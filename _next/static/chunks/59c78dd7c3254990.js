(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15452,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(18566),l=e.i(54858),r=e.i(47163),n=e.i(932);function i(e){let t,a,l,r,i,c,d,o,x,m=(0,n.c)(19),{friendRequestsCount:h,showFriendRequests:p,setShowFriendRequests:f,handleLogout:u,onOpenLeaderboard:b}=e;return m[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)("h1",{className:"text-2xl font-black text-white tracking-tighter italic",children:["Ê≥®Èü≥ ",(0,s.jsx)("span",{className:"text-indigo-500",children:"Â∞çÊà∞"})]})}),m[0]=t):t=m[0],m[1]===Symbol.for("react.memo_cache_sentinel")?(a=(0,s.jsx)("span",{className:"text-2xl",children:"üìä"}),m[1]=a):a=m[1],m[2]!==b?(l=(0,s.jsx)("button",{onClick:b,className:"px-3 py-2 text-slate-300 hover:text-white transition-colors flex items-center gap-2",title:"ÊéíË°åÊ¶ú",children:a}),m[2]=b,m[3]=l):l=m[3],m[4]!==f||m[5]!==p?(r=()=>f(!p),m[4]=f,m[5]=p,m[6]=r):r=m[6],m[7]===Symbol.for("react.memo_cache_sentinel")?(i=(0,s.jsx)("span",{className:"text-2xl",children:"üîî"}),m[7]=i):i=m[7],m[8]!==h?(c=h>0&&(0,s.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center font-bold",children:h}),m[8]=h,m[9]=c):c=m[9],m[10]!==r||m[11]!==c?(d=(0,s.jsxs)("button",{onClick:r,className:"relative px-3 py-2 text-slate-300 hover:text-white transition-colors",children:[i,c]}),m[10]=r,m[11]=c,m[12]=d):d=m[12],m[13]!==u?(o=(0,s.jsx)("button",{onClick:u,className:"px-4 py-2 text-sm font-medium text-slate-300 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors",children:"ÁôªÂá∫"}),m[13]=u,m[14]=o):o=m[14],m[15]!==l||m[16]!==d||m[17]!==o?(x=(0,s.jsxs)("nav",{className:"h-16 border-b border-slate-800 bg-[#1e293b]/80 backdrop-blur-md flex items-center justify-between px-6 flex-shrink-0 z-50",children:[t,(0,s.jsxs)("div",{className:"flex gap-4 items-center",children:[l,d,o]})]}),m[15]=l,m[16]=d,m[17]=o,m[18]=x):x=m[18],x}var c=e.i(85333);function d(e){let t,a,l=(0,n.c)(9),{user:i,selectedAvatar:d,setShowAvatarPicker:o,openProfileEdit:x,startMatching:m,isMatching:h}=e;return l[0]!==h||l[1]!==x||l[2]!==d||l[3]!==o||l[4]!==m||l[5]!==i?(t=i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"relative group",children:(0,s.jsx)("div",{className:"w-28 h-28 bg-gradient-to-tr from-indigo-600 to-purple-400 rounded-full border-4 border-slate-900 overflow-hidden shadow-2xl transition-transform group-hover:scale-105 cursor-pointer",onClick:()=>o(!0),children:(0,s.jsx)("img",{src:d||`https://api.dicebear.com/7.x/avataaars/svg?seed=${r.AVATAR_OPTIONS[0]}`,alt:i.username,className:"w-full h-full object-cover"})})}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-white tracking-tight",children:i.username}),(0,s.jsx)("button",{onClick:x,className:"text-slate-500 hover:text-indigo-400 transition-colors",title:"Á∑®ËºØÂÄã‰∫∫Ë≥áÊñô",children:"‚úèÔ∏è"})]}),i.bio&&(0,s.jsx)("p",{className:"text-sm text-slate-400 mt-1 italic",children:i.bio}),(0,s.jsx)("div",{className:"mt-3 flex flex-col items-center",children:i.games_played<10?(0,s.jsxs)("div",{className:"flex items-center gap-1 relative group",children:[(0,s.jsx)("p",{className:"text-sm text-amber-400",children:"ÂÆöÁ¥ö‰∏≠"}),(0,s.jsx)("span",{className:"text-xs text-amber-500 cursor-help",children:"‚ìò"}),(0,s.jsx)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 px-4 py-2.5 bg-slate-900 text-slate-100 text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap pointer-events-none z-10 shadow-xl border border-slate-700",children:(0,s.jsxs)("div",{className:"relative",children:["ÂÆåÊàê 10 Â†¥ÂÆöÁ¥öË≥ΩÂæåÂç≥ÂèØÊü•ÁúãÂàÜÊï∏",(0,s.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-px",children:(0,s.jsx)("div",{className:"border-4 border-transparent border-t-slate-900"})})]})})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,s.jsx)(c.default,{rating:i.rating||1500,size:64}),(0,s.jsxs)("p",{className:"text-sm text-slate-300",children:["Rating: ",(0,s.jsx)("span",{className:"text-amber-400 font-bold",children:i.rating||1500})]})]})}),(0,s.jsxs)("div",{className:"w-full mt-6 space-y-4",children:[(0,s.jsxs)("div",{className:"bg-slate-900/30 p-4 rounded-xl border border-slate-700/50",children:[(0,s.jsx)("h3",{className:"text-xs font-bold text-amber-400 mb-3 uppercase tracking-wider",children:"Á©çÂàÜÂ∞çÊà∞"}),(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-2 text-center",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[10px] text-slate-400",children:"Âãù"}),(0,s.jsx)("span",{className:"text-sm font-bold text-green-400",children:i.ranked_games_won||0})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[10px] text-slate-400",children:"Êïó"}),(0,s.jsx)("span",{className:"text-sm font-bold text-red-400",children:(i.ranked_games_played||0)-(i.ranked_games_won||0)})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[10px] text-slate-400",children:"Á∏Ω"}),(0,s.jsx)("span",{className:"text-sm font-bold text-slate-400",children:i.ranked_games_played||0})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[10px] text-slate-400",children:"Áéá"}),(0,s.jsxs)("span",{className:"text-sm font-bold text-emerald-400",children:[i.ranked_games_played>0?Math.round(i.ranked_games_won/i.ranked_games_played*100):0,"%"]})]})]})]}),(0,s.jsxs)("div",{className:"bg-slate-900/30 p-4 rounded-xl border border-slate-700/50",children:[(0,s.jsx)("h3",{className:"text-xs font-bold text-blue-400 mb-3 uppercase tracking-wider",children:"‰∏ÄËà¨Â∞çÊà∞"}),(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-2 text-center",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[10px] text-slate-400",children:"Âãù"}),(0,s.jsx)("span",{className:"text-sm font-bold text-green-400",children:i.casual_games_won||0})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[10px] text-slate-400",children:"Êïó"}),(0,s.jsx)("span",{className:"text-sm font-bold text-red-400",children:(i.casual_games_played||0)-(i.casual_games_won||0)})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[10px] text-slate-400",children:"Á∏Ω"}),(0,s.jsx)("span",{className:"text-sm font-bold text-slate-400",children:i.casual_games_played||0})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[10px] text-slate-400",children:"Áéá"}),(0,s.jsxs)("span",{className:"text-sm font-bold text-emerald-400",children:[i.casual_games_played>0?Math.round(i.casual_games_won/i.casual_games_played*100):0,"%"]})]})]})]}),(0,s.jsxs)("div",{className:"bg-slate-900/30 p-4 rounded-xl border border-slate-700/50",children:[(0,s.jsx)("h3",{className:"text-xs font-bold text-purple-400 mb-3 uppercase tracking-wider",children:"Â•ΩÂèãÂ∞çÊà∞"}),(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-2 text-center",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[10px] text-slate-400",children:"Âãù"}),(0,s.jsx)("span",{className:"text-sm font-bold text-green-400",children:i.custom_games_won||0})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[10px] text-slate-400",children:"Êïó"}),(0,s.jsx)("span",{className:"text-sm font-bold text-red-400",children:(i.custom_games_played||0)-(i.custom_games_won||0)})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[10px] text-slate-400",children:"Á∏Ω"}),(0,s.jsx)("span",{className:"text-sm font-bold text-slate-400",children:i.custom_games_played||0})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[10px] text-slate-400",children:"Áéá"}),(0,s.jsxs)("span",{className:"text-sm font-bold text-emerald-400",children:[i.custom_games_played>0?Math.round(i.custom_games_won/i.custom_games_played*100):0,"%"]})]})]})]})]}),(0,s.jsxs)("div",{className:"w-full mt-4 space-y-3",children:[(0,s.jsxs)("button",{onClick:()=>m("ranked"),disabled:h,className:"w-full bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 py-3 rounded-xl font-bold transition-all active:scale-95 flex items-center justify-center gap-2 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,s.jsx)("span",{children:"üèÜ"})," Á©çÂàÜÂ∞çÊà∞"]}),(0,s.jsxs)("button",{onClick:()=>m("casual"),disabled:h,className:"w-full bg-slate-700 hover:bg-slate-600 py-3 rounded-xl font-bold transition-all active:scale-95 flex items-center justify-center gap-2 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,s.jsx)("span",{children:"üéÆ"})," ‰∏ÄËà¨Â∞çÊà∞"]})]})]}),l[0]=h,l[1]=x,l[2]=d,l[3]=o,l[4]=m,l[5]=i,l[6]=t):t=l[6],l[7]!==t?(a=(0,s.jsx)("section",{className:"w-80 bg-[#1e293b] border-r border-slate-800 flex flex-col p-6 flex-shrink-0 overflow-y-auto",children:(0,s.jsx)("div",{className:"flex flex-col items-center flex-1",children:t})}),l[7]=t,l[8]=a):a=l[8],a}function o(e){let t,a,l,i,c,d,o,x,m,h=(0,n.c)(23),{friends:p,onlineUsers:f,openChat:u,viewUserDetail:b,sendFriendRequest:g}=e;return h[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,s.jsx)("span",{children:"üë•"}),h[0]=t):t=h[0],h[1]!==p.length?(a=(0,s.jsxs)("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[t," ÊàëÁöÑÂ•ΩÂèã (",p.length,")"]}),h[1]=p.length,h[2]=a):a=h[2],h[3]!==p||h[4]!==u||h[5]!==b?(l=0===p.length?(0,s.jsxs)("div",{className:"text-center py-8 text-slate-500",children:[(0,s.jsx)("p",{children:"ÈÇÑÊ≤íÊúâÂ•ΩÂèã"}),(0,s.jsx)("p",{className:"text-sm mt-1",children:"Âæû‰∏ãÊñπÁöÑÁ∑ö‰∏äÁî®Êà∂‰∏≠Ê∑ªÂä†Â•ΩÂèãÂêßÔºÅ"})]}):(0,s.jsx)("div",{className:"space-y-2",children:p.map(e=>(0,s.jsxs)("div",{onClick:()=>b(e.id),className:"bg-slate-800/50 p-3 rounded-xl border border-slate-700/50 hover:border-indigo-500/50 transition-all cursor-pointer relative group",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("img",{src:e.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.username}`,alt:e.username,className:"w-10 h-10 rounded-full border-2 border-indigo-500"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-medium text-white",children:e.username}),(0,s.jsx)("p",{className:"text-xs text-slate-400",children:e.seconds_offline<30?(0,s.jsx)("span",{className:"text-green-400",children:"‚óè Á∑ö‰∏ä"}):(0,r.formatLastOnline)(e.seconds_offline)})]})]}),(0,s.jsx)("button",{onClick:s=>{s.stopPropagation(),u(e)},className:"absolute top-2 right-2 p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-full transition-colors",title:"ËÅäÂ§©",children:"üí¨"})]},e.id))}),h[3]=p,h[4]=u,h[5]=b,h[6]=l):l=h[6],h[7]!==a||h[8]!==l?(i=(0,s.jsxs)("div",{className:"mb-8",children:[a,l]}),h[7]=a,h[8]=l,h[9]=i):i=h[9],h[10]===Symbol.for("react.memo_cache_sentinel")?(c=(0,s.jsx)("span",{children:"üåê"}),h[10]=c):c=h[10],h[11]!==f.length?(d=(0,s.jsxs)("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[c," Á∑ö‰∏äÁé©ÂÆ∂ (",f.length,")"]}),h[11]=f.length,h[12]=d):d=h[12],h[13]!==f||h[14]!==g||h[15]!==b?(o=0===f.length?(0,s.jsx)("div",{className:"text-center py-8 text-slate-500",children:(0,s.jsx)("p",{children:"ÁõÆÂâçÊ≤íÊúâÂÖ∂‰ªñÁ∑ö‰∏äÁé©ÂÆ∂"})}):(0,s.jsx)("div",{className:"space-y-2",children:f.map(e=>(0,s.jsxs)("div",{className:"w-full bg-slate-800/30 p-3 rounded-xl flex items-center gap-3 border border-slate-700/30",children:[(0,s.jsxs)("button",{onClick:()=>b(e.id),className:"flex items-center gap-3 flex-1 hover:opacity-80 transition-opacity",children:[(0,s.jsx)("img",{src:e.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.username}`,alt:e.username,className:"w-10 h-10 rounded-full border-2 border-slate-600"}),(0,s.jsxs)("div",{className:"flex-1 text-left",children:[(0,s.jsx)("p",{className:"font-medium text-white",children:e.username}),(0,s.jsx)("p",{className:"text-xs text-green-400",children:"‚óè Á∑ö‰∏ä"})]})]}),(0,s.jsx)("button",{onClick:s=>{s.stopPropagation(),g(e.id)},className:"px-3 py-1 bg-indigo-500 hover:bg-indigo-600 text-white text-sm rounded-lg transition-colors flex-shrink-0",children:"Âä†Â•ΩÂèã"})]},e.id))}),h[13]=f,h[14]=g,h[15]=b,h[16]=o):o=h[16],h[17]!==d||h[18]!==o?(x=(0,s.jsxs)("div",{children:[d,o]}),h[17]=d,h[18]=o,h[19]=x):x=h[19],h[20]!==i||h[21]!==x?(m=(0,s.jsxs)("section",{className:"w-80 flex flex-col bg-[#0f172a] p-6 overflow-y-auto border-l border-slate-800 flex-shrink-0",children:[i,x]}),h[20]=i,h[21]=x,h[22]=m):m=h[22],m}function x({user:e}){let r=(0,a.useRouter)(),[n,i]=(0,t.useState)([]);async function c(){try{let e=await (0,l.api)("/api/matchmaking/active");e.ok&&i(await e.json())}catch(e){console.error("Failed to fetch active battles:",e)}}(0,t.useEffect)(()=>{c();let e=setInterval(c,1e4);return()=>clearInterval(e)},[]);let d=n.filter(s=>e&&(s.player1_id===e.id||s.player2_id===e.id)),o=n.filter(s=>!e||s.player1_id!==e.id&&s.player2_id!==e.id),x=({battle:e,isMyBattle:t})=>(0,s.jsxs)("div",{className:`bg-slate-800/50 rounded-xl p-3 border transition-all cursor-pointer group ${t?"border-indigo-500/50 hover:border-indigo-400 hover:bg-indigo-900/20":"border-slate-700/50 hover:border-indigo-500/30 hover:bg-slate-800"}`,onClick:()=>r.push(`/battle?id=${e.id}`),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:`text-xs px-2 py-0.5 rounded-full ${"ranked"===e.mode?"bg-yellow-500/20 text-yellow-400 border border-yellow-500/30":"bg-blue-500/20 text-blue-400 border border-blue-500/30"}`,children:"ranked"===e.mode?"Á©çÂàÜÂ∞çÊà∞":"‰∏ÄËà¨Â∞çÊà∞"}),t&&(0,s.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full bg-green-500/20 text-green-400 border border-green-500/30 animate-pulse",children:"ÈÄ≤Ë°å‰∏≠"})]}),(0,s.jsx)("span",{className:"text-xs text-slate-500",children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,s.jsx)("img",{src:e.player1_avatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.player1_name}`,alt:e.player1_name,className:"w-8 h-8 rounded-full bg-slate-700"}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-slate-200 truncate",children:e.player1_name}),(0,s.jsx)("div",{className:"text-xs text-slate-500",children:e.player1_rating?`Rating: ${e.player1_rating}`:"Unranked"})]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("span",{className:"text-slate-600 font-bold text-sm",children:"VS"}),!t&&(0,s.jsx)("span",{className:"text-[10px] text-indigo-400 opacity-0 group-hover:opacity-100 transition-opacity",children:"ËßÄÊà∞"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0 justify-end text-right",children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-slate-200 truncate",children:e.player2_name}),(0,s.jsx)("div",{className:"text-xs text-slate-500",children:e.player2_rating?`Rating: ${e.player2_rating}`:"Unranked"})]}),(0,s.jsx)("img",{src:e.player2_avatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.player2_name}`,alt:e.player2_name,className:"w-8 h-8 rounded-full bg-slate-700"})]})]})]});return(0,s.jsxs)("div",{className:"flex-1 bg-slate-900/50 border-x border-slate-800 flex flex-col min-w-0",children:[d.length>0&&(0,s.jsxs)("div",{className:"flex-shrink-0",children:[(0,s.jsx)("div",{className:"p-4 border-b border-slate-800 bg-indigo-900/10",children:(0,s.jsxs)("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[(0,s.jsx)("span",{children:"‚öîÔ∏è"})," ÊàëÁöÑÂ∞çÊà∞"]})}),(0,s.jsx)("div",{className:"p-4 space-y-3 border-b border-slate-800",children:d.map(e=>(0,s.jsx)(x,{battle:e,isMyBattle:!0},e.id))})]}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[(0,s.jsx)("div",{className:"p-4 border-b border-slate-800",children:(0,s.jsxs)("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),"Ê≠£Âú®ÈÄ≤Ë°åÁöÑÂ∞çÊà∞"]})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:0===o.length?(0,s.jsx)("div",{className:"text-center py-12 text-slate-500",children:(0,s.jsx)("p",{children:"ÁõÆÂâçÊ≤íÊúâÂÖ∂‰ªñÊ≠£Âú®ÈÄ≤Ë°åÁöÑÂ∞çÊà∞"})}):o.map(e=>(0,s.jsx)(x,{battle:e,isMyBattle:!1},e.id))})]})]})}function m(e){let t,a,i,c,d,o,x=(0,n.c)(14),{showAvatarPicker:m,setShowAvatarPicker:h,currentAvatar:p,onUpdate:f}=e;x[0]!==f||x[1]!==h?(t=async function(e){let s=`https://api.dicebear.com/7.x/avataaars/svg?seed=${e}`;try{let e=await (0,l.api)("/api/users/me",{method:"PATCH",body:JSON.stringify({avatar_url:s})});if(e.ok){let s=await e.json();f(s),h(!1)}}catch(e){console.error("Failed to update avatar:",e)}},x[0]=f,x[1]=h,x[2]=t):t=x[2];let u=t;return m?(x[3]===Symbol.for("react.memo_cache_sentinel")?(a=(0,s.jsx)("h3",{className:"text-xl font-bold text-white",children:"ÈÅ∏Êìá‰Ω†ÁöÑÈ†≠ÂÉè"}),x[3]=a):a=x[3],x[4]!==h?(i=(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[a,(0,s.jsx)("button",{onClick:()=>h(!1),className:"text-slate-400 hover:text-white text-2xl leading-none",children:"√ó"})]}),x[4]=h,x[5]=i):i=x[5],x[6]!==p||x[7]!==u?(c=r.AVATAR_OPTIONS.map(e=>{let t=`https://api.dicebear.com/7.x/avataaars/svg?seed=${e}`,a=p===t;return(0,s.jsxs)("button",{onClick:()=>u(e),className:`relative w-full aspect-square rounded-xl overflow-hidden border-4 transition-all hover:scale-105 ${a?"border-indigo-500 shadow-lg shadow-indigo-500/50":"border-slate-700 hover:border-slate-500"}`,children:[(0,s.jsx)("img",{src:t,alt:e,className:"w-full h-full object-cover bg-gradient-to-br from-indigo-600 to-purple-400"}),a&&(0,s.jsx)("div",{className:"absolute inset-0 bg-indigo-500/20 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-3xl",children:"‚úì"})})]},e)}),x[6]=p,x[7]=u,x[8]=c):c=x[8],x[9]!==c?(d=(0,s.jsx)("div",{className:"grid grid-cols-5 gap-4 max-h-96 overflow-y-auto p-2",children:c}),x[9]=c,x[10]=d):d=x[10],x[11]!==i||x[12]!==d?(o=(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"bg-[#1e293b] p-6 rounded-2xl w-full max-w-2xl border border-slate-700 shadow-2xl",children:[i,d]})}),x[11]=i,x[12]=d,x[13]=o):o=x[13],o):null}function h({showProfileEdit:e,setShowProfileEdit:a,user:r,onUpdate:n}){let[i,c]=(0,t.useState)(""),[d,o]=(0,t.useState)("");async function x(){try{let e=await (0,l.api)("/api/users/me",{method:"PATCH",body:JSON.stringify({username:i,bio:d})});if(e.ok){let s=await e.json();n(s),a(!1)}else{let s=await e.json();alert(s.error||"Êõ¥Êñ∞Â§±Êïó")}}catch(e){console.error("Failed to update profile:",e),alert("Êõ¥Êñ∞Â§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶")}}return((0,t.useEffect)(()=>{e&&r&&(c(r.username||""),o(r.bio||""))},[e,r]),e)?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"bg-[#1e293b] p-6 rounded-2xl w-full max-w-md border border-slate-700 shadow-2xl",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-white",children:"Á∑®ËºØÂÄã‰∫∫Ë≥áÊñô"}),(0,s.jsx)("button",{onClick:()=>a(!1),className:"text-slate-400 hover:text-white text-2xl leading-none",children:"√ó"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"‰ΩøÁî®ËÄÖÂêçÁ®±"}),(0,s.jsx)("input",{type:"text",value:i,onChange:e=>c(e.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-indigo-500 transition-colors",placeholder:"Ëº∏ÂÖ•‰ΩøÁî®ËÄÖÂêçÁ®±",maxLength:20})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"ÂÄã‰∫∫Á∞°‰ªã"}),(0,s.jsx)("textarea",{value:d,onChange:e=>o(e.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-indigo-500 transition-colors resize-none",placeholder:"ÂØ´ÈªûÈóúÊñºËá™Â∑±ÁöÑ‰∫ãÊÉÖ...",rows:3,maxLength:100}),(0,s.jsxs)("p",{className:"text-xs text-slate-500 mt-1 text-right",children:[d.length," / 100"]})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,s.jsx)("button",{onClick:()=>a(!1),className:"flex-1 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-medium transition-colors",children:"ÂèñÊ∂à"}),(0,s.jsx)("button",{onClick:x,className:"flex-1 px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-medium transition-colors",children:"ÂÑ≤Â≠ò"})]})]})}):null}function p(e){let t,a,l,i,d,o,x,m,h,p,u,b,g,j,N,v,w,y,_,k=(0,n.c)(60),{showUserDetail:S,setShowUserDetail:I,selectedUser:C,addFriend:$,removeFriend:R,onChallenge:O}=e;if(!S||!C)return null;let T=f;k[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,s.jsx)("h3",{className:"text-xl font-bold text-white",children:"Áé©ÂÆ∂Ë≥áÊñô"}),k[0]=t):t=k[0],k[1]!==I?(a=(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[t,(0,s.jsx)("button",{onClick:()=>I(!1),className:"text-slate-400 hover:text-white text-2xl leading-none",children:"√ó"})]}),k[1]=I,k[2]=a):a=k[2];let P=C.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${C.username}`;k[3]!==C.username||k[4]!==P?(l=(0,s.jsx)("img",{src:P,alt:C.username,className:"w-24 h-24 rounded-full border-4 border-indigo-500 mb-4"}),k[3]=C.username,k[4]=P,k[5]=l):l=k[5],k[6]!==C.username?(i=(0,s.jsx)("h2",{className:"text-2xl font-bold text-white",children:C.username}),k[6]=C.username,k[7]=i):i=k[7],k[8]!==C.seconds_offline?(d=C.seconds_offline<300?(0,s.jsx)("p",{className:"text-green-400 text-sm mt-1",children:"‚óè Á∑ö‰∏ä"}):(0,s.jsxs)("p",{className:"text-slate-400 text-sm mt-1",children:["Èõ¢Á∑ö ",(0,r.formatLastOnline)(C.seconds_offline)]}),k[8]=C.seconds_offline,k[9]=d):d=k[9],k[10]!==C.bio?(o=C.bio&&(0,s.jsx)("p",{className:"text-slate-300 text-sm mt-3 text-center italic",children:C.bio}),k[10]=C.bio,k[11]=o):o=k[11],k[12]!==C.rating?(x=C.rating&&(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(c.default,{rating:C.rating,size:64})}),k[12]=C.rating,k[13]=x):x=k[13],k[14]!==O||k[15]!==C.id||k[16]!==C.is_friend?(m=C.is_friend&&O&&(0,s.jsxs)("button",{onClick:()=>O(C.id),className:"px-6 py-2 bg-amber-600 hover:bg-amber-500 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:[(0,s.jsx)("span",{children:"‚öîÔ∏è"})," Á¥ÑÊà∞"]}),k[14]=O,k[15]=C.id,k[16]=C.is_friend,k[17]=m):m=k[17],k[18]!==$||k[19]!==R||k[20]!==C.id||k[21]!==C.is_friend||k[22]!==I?(h=C.is_friend?R&&(0,s.jsx)("button",{onClick:()=>{confirm("Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄô‰ΩçÂ•ΩÂèãÂóéÔºü")&&(R(C.id),I(!1))},className:"px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg font-medium transition-colors",children:"Âà™Èô§Â•ΩÂèã"}):(0,s.jsx)("button",{onClick:()=>$(C.id),className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-medium transition-colors",children:"Âä†ÁÇ∫Â•ΩÂèã"}),k[18]=$,k[19]=R,k[20]=C.id,k[21]=C.is_friend,k[22]=I,k[23]=h):h=k[23],k[24]!==h||k[25]!==m?(p=(0,s.jsxs)("div",{className:"flex gap-3 mt-4 w-full justify-center",children:[m,h]}),k[24]=h,k[25]=m,k[26]=p):p=k[26],k[27]!==p||k[28]!==l||k[29]!==i||k[30]!==d||k[31]!==o||k[32]!==x?(u=(0,s.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[l,i,d,o,x,p]}),k[27]=p,k[28]=l,k[29]=i,k[30]=d,k[31]=o,k[32]=x,k[33]=u):u=k[33],k[34]===Symbol.for("react.memo_cache_sentinel")?(b=(0,s.jsx)("h4",{className:"text-xs font-bold text-amber-400 mb-3 uppercase tracking-wider",children:"Á©çÂàÜÂ∞çÊà∞"}),k[34]=b):b=k[34],k[35]!==C.ranked_games_played||k[36]!==C.ranked_games_won||k[37]!==C.rating?(g=(0,s.jsxs)("div",{className:"bg-slate-900/50 p-4 rounded-xl",children:[b,C.ranked_games_played<10?(0,s.jsxs)("div",{className:"bg-slate-800/50 rounded-lg p-3",children:[(0,s.jsx)("p",{className:"text-sm text-amber-400 text-center font-medium",children:"ÂÆöÁ¥ö‰∏≠"}),(0,s.jsx)("p",{className:"text-xs text-slate-400 text-center mt-2",children:"ÂÆåÊàê 10 Â†¥ÂÆöÁ¥öË≥ΩÂæåÂ∞áÈ°ØÁ§∫ÊÆµ‰Ωç"}),(0,s.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("span",{className:"text-slate-400 text-xs",children:"Â∑≤ÂÆåÊàê"}),(0,s.jsxs)("span",{className:"font-bold text-white",children:[C.ranked_games_played,"/10"]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("span",{className:"text-slate-400 text-xs",children:"ÂãùÂ†¥"}),(0,s.jsx)("span",{className:"font-bold text-green-400",children:C.ranked_games_won})]})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-slate-400 text-xs block",children:"ÊÆµ‰Ωç"}),(0,s.jsx)("span",{className:`font-bold text-lg ${(0,r.getRankInfo)(C.rating).color}`,children:(0,r.getRankInfo)(C.rating).nameZh})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("span",{className:"text-slate-400 text-xs block",children:"Rating"}),(0,s.jsx)("span",{className:"font-bold text-lg text-amber-400",children:C.rating})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-slate-400 text-xs",children:"ÂãùÂ†¥"}),(0,s.jsx)("span",{className:"font-bold text-green-400",children:C.ranked_games_won})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-slate-400 text-xs",children:"ÊïóÂ†¥"}),(0,s.jsx)("span",{className:"font-bold text-red-400",children:C.ranked_games_played-C.ranked_games_won})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-slate-400 text-xs",children:"Á∏ΩÂ†¥Ê¨°"}),(0,s.jsx)("span",{className:"font-bold text-white",children:C.ranked_games_played})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-slate-400 text-xs",children:"ÂãùÁéá"}),(0,s.jsxs)("span",{className:"font-bold text-emerald-400",children:[C.ranked_games_played>0?Math.round(C.ranked_games_won/C.ranked_games_played*100):0,"%"]})]})]})]})]}),k[35]=C.ranked_games_played,k[36]=C.ranked_games_won,k[37]=C.rating,k[38]=g):g=k[38];let F=C.casual_games_played||0,A=C.casual_games_won||0;k[39]!==F||k[40]!==A?(j=T("‰∏ÄËà¨Â∞çÊà∞",F,A,"text-blue-400"),k[39]=F,k[40]=A,k[41]=j):j=k[41];let E=C.custom_games_played||0,M=C.custom_games_won||0;return k[42]!==E||k[43]!==M?(N=T("Â•ΩÂèãÂ∞çÊà∞",E,M,"text-purple-400"),k[42]=E,k[43]=M,k[44]=N):N=k[44],k[45]!==g||k[46]!==j||k[47]!==N?(v=(0,s.jsxs)("div",{className:"space-y-4 mb-6",children:[g,j,N]}),k[45]=g,k[46]=j,k[47]=N,k[48]=v):v=k[48],k[49]!==C.ranked_games_played||k[50]!==C.rating?(w=C.ranked_games_played>=10&&(0,s.jsxs)("div",{className:"bg-slate-900/50 p-4 rounded-xl mb-6",children:[(0,s.jsx)("h4",{className:"text-sm font-bold text-white mb-3",children:"Rating ÂàÜ‰Ωà"}),(0,s.jsxs)("div",{className:"relative pt-6 pb-2",children:[(0,s.jsxs)("div",{className:"absolute top-0 left-0 right-0 flex justify-between text-[10px] text-slate-500",children:[(0,s.jsx)("span",{style:{left:"0%"},className:"absolute",children:"0"}),(0,s.jsx)("span",{style:{left:"14%"},className:"absolute",children:"800"}),(0,s.jsx)("span",{style:{left:"28%"},className:"absolute",children:"1200"}),(0,s.jsx)("span",{style:{left:"42%"},className:"absolute",children:"1500"}),(0,s.jsx)("span",{style:{left:"57%"},className:"absolute",children:"1800"}),(0,s.jsx)("span",{style:{left:"71%"},className:"absolute",children:"2200"}),(0,s.jsx)("span",{style:{left:"85%"},className:"absolute",children:"2500"})]}),(0,s.jsxs)("div",{className:"relative h-4 bg-slate-800 rounded-full overflow-hidden mt-1",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-slate-600 via-amber-700 via-slate-400 via-yellow-500 via-cyan-500 via-blue-600 to-purple-600 opacity-50"}),(0,s.jsx)("div",{className:"absolute top-0 bottom-0 w-1 bg-white shadow-[0_0_10px_rgba(255,255,255,0.8)] z-10",style:{left:`${Math.min(Math.max(C.rating/3e3*100,0),100)}%`},children:(0,s.jsx)("div",{className:"absolute -top-7 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white text-xs font-bold px-2 py-0.5 rounded border border-slate-600 whitespace-nowrap",children:C.rating})})]}),(0,s.jsxs)("div",{className:"flex justify-between items-start mt-2 px-1",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center w-8",children:[(0,s.jsx)("span",{className:"text-[10px] text-slate-500",children:"Èêµ"}),(0,s.jsx)("span",{className:"text-[9px] text-slate-600",children:"0-800"})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center w-8",children:[(0,s.jsx)("span",{className:"text-[10px] text-amber-700",children:"ÈäÖ"}),(0,s.jsx)("span",{className:"text-[9px] text-slate-600",children:"800+"})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center w-8",children:[(0,s.jsx)("span",{className:"text-[10px] text-slate-300",children:"ÈäÄ"}),(0,s.jsx)("span",{className:"text-[9px] text-slate-600",children:"1200+"})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center w-8",children:[(0,s.jsx)("span",{className:"text-[10px] text-yellow-500",children:"Èáë"}),(0,s.jsx)("span",{className:"text-[9px] text-slate-600",children:"1500+"})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center w-8",children:[(0,s.jsx)("span",{className:"text-[10px] text-cyan-400",children:"ÁôΩÈáë"}),(0,s.jsx)("span",{className:"text-[9px] text-slate-600",children:"1800+"})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center w-8",children:[(0,s.jsx)("span",{className:"text-[10px] text-blue-400",children:"ÈëΩÁü≥"}),(0,s.jsx)("span",{className:"text-[9px] text-slate-600",children:"2200+"})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center w-8",children:[(0,s.jsx)("span",{className:"text-[10px] text-purple-400",children:"Â§ßÂ∏´"}),(0,s.jsx)("span",{className:"text-[9px] text-slate-600",children:"2500+"})]})]})]})]}),k[49]=C.ranked_games_played,k[50]=C.rating,k[51]=w):w=k[51],k[52]!==I?(y=(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)("button",{onClick:()=>I(!1),className:"w-full px-4 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-medium transition-colors",children:"ÈóúÈñâ"})}),k[52]=I,k[53]=y):y=k[53],k[54]!==u||k[55]!==a||k[56]!==v||k[57]!==w||k[58]!==y?(_=(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"bg-[#1e293b] p-6 rounded-2xl w-full max-w-lg border border-slate-700 shadow-2xl max-h-[90vh] overflow-y-auto",children:[a,u,v,w,y]})}),k[54]=u,k[55]=a,k[56]=v,k[57]=w,k[58]=y,k[59]=_):_=k[59],_}function f(e,t,a,l){let r=t>0?Math.round(a/t*100):0;return(0,s.jsxs)("div",{className:"bg-slate-900/50 p-4 rounded-xl",children:[(0,s.jsx)("h4",{className:`text-xs font-bold ${l} mb-3 uppercase tracking-wider`,children:e}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-slate-400 text-xs",children:"ÂãùÂ†¥"}),(0,s.jsx)("span",{className:"font-bold text-green-400",children:a})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-slate-400 text-xs",children:"ÊïóÂ†¥"}),(0,s.jsx)("span",{className:"font-bold text-red-400",children:t-a})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-slate-400 text-xs",children:"Á∏ΩÂ†¥Ê¨°"}),(0,s.jsx)("span",{className:"font-bold text-white",children:t})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-slate-400 text-xs",children:"ÂãùÁéá"}),(0,s.jsxs)("span",{className:"font-bold text-emerald-400",children:[r,"%"]})]})]})]})}function u(e){let t,a,l,i,c,d=(0,n.c)(16),{showFriendRequests:o,setShowFriendRequests:x,friendRequests:m,acceptFriendRequest:h,rejectFriendRequest:p,battleInvites:f,acceptBattleInvite:u,rejectBattleInvite:b}=e;d[0]!==f?(t=void 0===f?[]:f,d[0]=f,d[1]=t):t=d[1];let g=t;if(!o)return null;let j=m.length>0||g.length>0;return d[2]===Symbol.for("react.memo_cache_sentinel")?(a=(0,s.jsx)("h3",{className:"text-xl font-bold text-white",children:"ÈÄöÁü•‰∏≠ÂøÉ"}),d[2]=a):a=d[2],d[3]!==x?(l=(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[a,(0,s.jsx)("button",{onClick:()=>x(!1),className:"text-slate-400 hover:text-white text-2xl leading-none",children:"√ó"})]}),d[3]=x,d[4]=l):l=d[4],d[5]!==u||d[6]!==h||d[7]!==g||d[8]!==m||d[9]!==j||d[10]!==b||d[11]!==p?(i=j?(0,s.jsxs)("div",{className:"space-y-6 max-h-[70vh] overflow-y-auto pr-2",children:[g.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-xs font-bold text-amber-400 mb-3 uppercase tracking-wider",children:"Â∞çÊà∞ÈÇÄË´ã"}),(0,s.jsx)("div",{className:"space-y-3",children:g.map(e=>(0,s.jsxs)("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-amber-500/30",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,s.jsx)("img",{src:e.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.username}`,alt:e.username,className:"w-12 h-12 rounded-full border-2 border-amber-500"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("p",{className:"font-medium text-white",children:[(0,s.jsx)("span",{className:"text-amber-400",children:e.username})," ÈÇÄË´ã‰Ω†ÈÄ≤Ë°åÂ∞çÊà∞"]}),(0,s.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:new Date(e.created_at).toLocaleTimeString()})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>u&&u(e.id),className:"flex-1 px-4 py-2 bg-amber-600 hover:bg-amber-500 text-white rounded-lg font-medium transition-colors",children:"Êé•ÂèóÊåëÊà∞"}),(0,s.jsx)("button",{onClick:()=>b&&b(e.id),className:"flex-1 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-medium transition-colors",children:"ÊãíÁµï"})]})]},e.id))})]}),m.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-xs font-bold text-indigo-400 mb-3 uppercase tracking-wider",children:"Â•ΩÂèãË´ãÊ±Ç"}),(0,s.jsx)("div",{className:"space-y-3",children:m.map(e=>(0,s.jsxs)("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700/50",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,s.jsx)("img",{src:e.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.username}`,alt:e.username,className:"w-12 h-12 rounded-full border-2 border-indigo-500"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-medium text-white",children:e.username}),e.games_played>=10?(0,s.jsxs)("p",{className:`text-sm ${(0,r.getRankInfo)(e.rating).color}`,children:[(0,r.getRankInfo)(e.rating).nameZh," ¬∑ ",e.rating]}):(0,s.jsx)("p",{className:"text-sm text-amber-400",children:"ÂÆöÁ¥ö‰∏≠"})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>h(e.request_id),className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg font-medium transition-colors",children:"Êé•Âèó"}),(0,s.jsx)("button",{onClick:()=>p(e.request_id),className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg font-medium transition-colors",children:"ÊãíÁµï"})]})]},e.request_id))})]})]}):(0,s.jsx)("div",{className:"text-center py-8 text-slate-500",children:(0,s.jsx)("p",{children:"ÁõÆÂâçÊ≤íÊúâÊñ∞ÁöÑÈÄöÁü•"})}),d[5]=u,d[6]=h,d[7]=g,d[8]=m,d[9]=j,d[10]=b,d[11]=p,d[12]=i):i=d[12],d[13]!==l||d[14]!==i?(c=(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"bg-[#1e293b] p-6 rounded-2xl w-full max-w-md border border-slate-700 shadow-2xl",children:[l,i]})}),d[13]=l,d[14]=i,d[15]=c):c=d[15],c}function b({showChat:e,setShowChat:a,chatFriend:n,user:i}){let[c,d]=(0,t.useState)([]),[o,x]=(0,t.useState)(""),m=(0,t.useRef)(null);(0,t.useEffect)(()=>{if(e&&n){p();let e=setInterval(p,3e3);return()=>clearInterval(e)}},[e,n]),(0,t.useEffect)(()=>{h()},[c]);let h=()=>{m.current?.scrollIntoView({behavior:"smooth"})};async function p(){if(n)try{let e=await (0,l.api)(`/api/friends/messages/${n.id}`);if(e.ok){let s=await e.json();d(s)}}catch(e){console.error("Failed to load messages:",e)}}async function f(){if(o.trim()&&n)try{(await (0,l.api)(`/api/friends/send-message/${n.id}`,{method:"POST",body:JSON.stringify({content:o})})).ok&&(x(""),p())}catch(e){console.error("Failed to send message:",e)}}return e&&n?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"bg-[#1e293b] rounded-2xl w-full max-w-2xl h-[600px] border border-slate-700 shadow-2xl flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("img",{src:n.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${n.username}`,alt:n.username,className:"w-10 h-10 rounded-full border-2 border-indigo-500"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-white",children:n.username}),(0,s.jsx)("p",{className:"text-xs text-slate-400",children:n.seconds_offline<30?(0,s.jsx)("span",{className:"text-green-400",children:"‚óè Á∑ö‰∏ä"}):(0,r.formatLastOnline)(n.seconds_offline)})]})]}),(0,s.jsx)("button",{onClick:()=>{a(!1)},className:"text-slate-400 hover:text-white text-2xl leading-none",children:"√ó"})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[0===c.length?(0,s.jsxs)("div",{className:"text-center py-8 text-slate-500",children:[(0,s.jsx)("p",{children:"ÈÇÑÊ≤íÊúâË®äÊÅØ"}),(0,s.jsx)("p",{className:"text-sm mt-1",children:"ÈñãÂßãËÅäÂ§©ÂêßÔºÅ"})]}):c.map(e=>{let t=e.sender_id===i?.id;return(0,s.jsx)("div",{className:`flex ${t?"justify-end":"justify-start"}`,children:(0,s.jsxs)("div",{className:`max-w-[70%] ${t?"items-end":"items-start"} flex flex-col`,children:[(0,s.jsx)("div",{className:`px-4 py-2 rounded-2xl ${t?"bg-indigo-600 text-white":"bg-slate-700 text-slate-200"}`,children:e.content}),(0,s.jsx)("span",{className:"text-xs text-slate-500 mt-1 px-1",children:function(e){let s=new Date(e),t=Math.floor((new Date().getTime()-s.getTime())/1e3);if(t<60)return"ÂâõÂâõ";let a=Math.floor(t/60);if(a<60)return`${a} ÂàÜÈêòÂâç`;let l=Math.floor(a/60);return l<24?`${l} Â∞èÊôÇÂâç`:s.toLocaleString("zh-TW",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}(e.created_at)})]})},e.id)}),(0,s.jsx)("div",{ref:m})]}),(0,s.jsx)("div",{className:"p-4 border-t border-slate-700 bg-slate-800/50 rounded-b-2xl",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:o,onChange:e=>x(e.target.value),onKeyDown:e=>"Enter"===e.key&&f(),placeholder:"Ëº∏ÂÖ•Ë®äÊÅØ...",className:"flex-1 px-4 py-2 bg-slate-900 border border-slate-700 rounded-full text-white focus:outline-none focus:border-indigo-500 transition-colors"}),(0,s.jsx)("button",{onClick:f,disabled:!o.trim(),className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-500 disabled:bg-slate-700 disabled:text-slate-500 text-white rounded-full font-medium transition-colors",children:"ÁôºÈÄÅ"})]})})]})}):null}function g(e){let t,a,l=(0,n.c)(6),{isMatching:r,matchStatus:i,matchMode:d,cancelMatching:o,opponent:x}=e;return r?(l[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,s.jsx)("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-indigo-500 to-transparent animate-shimmer"}),l[0]=t):t=l[0],l[1]!==o||l[2]!==d||l[3]!==i||l[4]!==x?(a=(0,s.jsx)("div",{className:"fixed inset-0 bg-slate-900/90 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"bg-slate-800 p-8 rounded-2xl border border-slate-700 shadow-2xl max-w-md w-full text-center relative overflow-hidden",children:[t,"waiting"===i?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"mb-6 relative",children:[(0,s.jsx)("div",{className:"w-24 h-24 mx-auto border-4 border-indigo-500/30 border-t-indigo-500 rounded-full animate-spin"}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-4xl",children:"üîç"})})]}),(0,s.jsx)("h3",{className:"text-2xl font-bold text-white mb-2",children:"Ê≠£Âú®Â∞ãÊâæÂ∞çÊâã..."}),(0,s.jsxs)("p",{className:"text-slate-400 mb-8",children:["ranked"===d?"Á©çÂàÜÂ∞çÊà∞":"‰∏ÄËà¨Â∞çÊà∞"," ‚Ä¢ È†êË®àÁ≠âÂæÖÊôÇÈñì: 30Áßí"]}),(0,s.jsx)("button",{onClick:o,className:"px-8 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-bold transition-colors",children:"ÂèñÊ∂àÂåπÈÖç"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mb-6 relative",children:(0,s.jsx)("div",{className:"w-24 h-24 mx-auto bg-green-500 rounded-full flex items-center justify-center animate-bounce",children:(0,s.jsx)("span",{className:"text-4xl",children:"‚öîÔ∏è"})})}),(0,s.jsx)("h3",{className:"text-2xl font-bold text-white mb-2",children:"ÂåπÈÖçÊàêÂäüÔºÅ"}),(0,s.jsx)("p",{className:"text-slate-400 mb-6",children:"Âç≥Â∞áÈñãÂßãÂ∞çÊà∞"}),x&&(0,s.jsxs)("div",{className:"bg-slate-900/50 p-4 rounded-xl border border-slate-700 mb-6 flex items-center gap-4",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-slate-700 rounded-full overflow-hidden",children:(0,s.jsx)("img",{src:x.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${x.username}`,alt:x.username,className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{className:"text-left flex-1",children:[(0,s.jsx)("div",{className:"font-bold text-white",children:x.username}),(0,s.jsxs)("div",{className:"text-sm text-slate-400",children:["Rating: ",null!==x.rating?x.rating:"Êú™ÂÆöÁ¥ö"]})]}),null!==x.rating&&(0,s.jsx)(c.default,{rating:x.rating,size:40})]}),(0,s.jsx)("div",{className:"w-full bg-slate-700 h-2 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-green-500 animate-[width_3s_linear_forwards]",style:{width:"100%"}})})]})]})}),l[1]=o,l[2]=d,l[3]=i,l[4]=x,l[5]=a):a=l[5],a):null}let j=["IRON","BRONZE","SILVER","GOLD","PLATINUM","DIAMOND","MASTER","GRANDMASTER"],N={IRON:{nameZh:"ÈêµÁâå",gradient:"from-zinc-500 to-zinc-700",rating:700},BRONZE:{nameZh:"ÈäÖÁâå",gradient:"from-amber-600 to-amber-800",rating:900},SILVER:{nameZh:"ÈäÄÁâå",gradient:"from-slate-300 to-slate-500",rating:1100},GOLD:{nameZh:"ÈáëÁâå",gradient:"from-yellow-300 to-yellow-600",rating:1350},PLATINUM:{nameZh:"ÁôΩÈáë",gradient:"from-cyan-300 to-cyan-600",rating:1650},DIAMOND:{nameZh:"ÈëΩÁü≥",gradient:"from-blue-400 to-blue-700",rating:2e3},MASTER:{nameZh:"Â§ßÂ∏´",gradient:"from-purple-400 to-purple-700",rating:2300},GRANDMASTER:{nameZh:"ÂÆóÂ∏´",gradient:"from-red-400 to-red-700",rating:2600}};function v(e){let a,r,i,d,o,x,m,h,p,f=(0,n.c)(17),{show:u,onClose:b}=e;f[0]===Symbol.for("react.memo_cache_sentinel")?(a=[],f[0]=a):a=f[0];let[g,v]=(0,t.useState)(a),[_,k]=(0,t.useState)(!0);if(f[1]!==u?(r=()=>{u&&(k(!0),(0,l.api)("/api/users/rank-distribution").then(y).then(e=>{v(j.map(s=>{let t=e.find(e=>e.rank===s);return{rank:s,count:t?t.count:0}})),k(!1)}).catch(e=>{console.error(e),k(!1)}))},i=[u],f[1]=u,f[2]=r,f[3]=i):(r=f[2],i=f[3]),(0,t.useEffect)(r,i),!u)return null;f[4]!==g?(d=Math.max(...g.map(w),1),f[4]=g,f[5]=d):d=f[5];let S=d;return f[6]!==b?(o=(0,s.jsx)("button",{onClick:b,className:"absolute top-4 right-4 text-slate-400 hover:text-white text-2xl leading-none",children:"√ó"}),f[6]=b,f[7]=o):o=f[7],f[8]===Symbol.for("react.memo_cache_sentinel")?(x=(0,s.jsx)("h2",{className:"text-2xl font-bold text-white mb-8 text-center",children:"ÂÖ®ÊúçÊÆµ‰ΩçÂàÜ‰Ωà"}),f[8]=x):x=f[8],f[9]!==g||f[10]!==_||f[11]!==S?(m=_?(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"})}):(0,s.jsx)("div",{className:"h-80 flex items-end justify-between gap-2 px-4",children:g.map(e=>{let t=N[e.rank],a=e.count/S*100;return(0,s.jsxs)("div",{className:"flex flex-col items-center flex-1 group relative",children:[(0,s.jsxs)("div",{className:"absolute bottom-full mb-2 opacity-0 group-hover:opacity-100 transition-opacity bg-slate-800 text-white text-xs px-2 py-1 rounded border border-slate-600 whitespace-nowrap z-10",children:[e.count," ‰∫∫ (",t.nameZh,")"]}),(0,s.jsx)("div",{className:`w-full rounded-t-lg bg-gradient-to-t ${t.gradient} transition-all duration-500 hover:brightness-110 relative`,style:{height:`${Math.max(a,2)}%`},children:(0,s.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-white/30"})}),(0,s.jsxs)("div",{className:"mt-3 flex flex-col items-center gap-1",children:[(0,s.jsx)("div",{className:"transform transition-transform group-hover:scale-110",children:(0,s.jsx)(c.default,{rating:t.rating,size:32})}),(0,s.jsx)("span",{className:"text-[10px] text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity absolute top-full mt-1 whitespace-nowrap",children:t.nameZh})]})]},e.rank)})}),f[9]=g,f[10]=_,f[11]=S,f[12]=m):m=f[12],f[13]===Symbol.for("react.memo_cache_sentinel")?(h=(0,s.jsx)("div",{className:"mt-8 text-center text-slate-500 text-sm",children:"Áµ±Ë®àÁØÑÂúçÔºöÂÆåÊàê 10 Â†¥ÂÆöÁ¥öË≥ΩÁöÑÊ¥ªË∫çÁé©ÂÆ∂"}),f[13]=h):h=f[13],f[14]!==o||f[15]!==m?(p=(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"bg-[#1e293b] p-8 rounded-2xl w-full max-w-4xl border border-slate-700 shadow-2xl relative",children:[o,x,m,h]})}),f[14]=o,f[15]=m,f[16]=p):p=f[16],p}function w(e){return e.count}function y(e){return e.json()}function _(){let e=(0,a.useRouter)(),[n,c]=(0,t.useState)(!0),[f,j]=(0,t.useState)(null),[N,w]=(0,t.useState)(!1),[y,_]=(0,t.useState)(!1),[k,S]=(0,t.useState)(!1),[I,C]=(0,t.useState)(!1),[$,R]=(0,t.useState)(!1),[O,T]=(0,t.useState)(!1),[P,F]=(0,t.useState)([]),[A,E]=(0,t.useState)([]),[M,q]=(0,t.useState)([]),[z,L]=(0,t.useState)([]),[D,Z]=(0,t.useState)(null),[U,B]=(0,t.useState)(null),[J,V]=(0,t.useState)(!1),[G,K]=(0,t.useState)(null),[H,W]=(0,t.useState)(null),[Q,X]=(0,t.useState)(null),[Y,ee]=(0,t.useState)(null),es=f?.avatar_url||r.AVATAR_OPTIONS[0];async function et(e){try{let s=await (0,l.api)(`/api/friends/invite-battle/${e}`,{method:"POST"});if(s.ok)alert("Â∑≤ÁôºÈÄÅÁ¥ÑÊà∞ÈÇÄË´ãÔºÅ");else{let e=await s.json();alert(e.error||"ÁôºÈÄÅÈÇÄË´ãÂ§±Êïó")}}catch(e){console.error("Challenge error:",e)}}async function ea(s){try{let t=await (0,l.api)(`/api/friends/accept-battle-invite/${s}`,{method:"POST"});if(t.ok){let s=await t.json();e.push(`/battle?id=${s.battleId}`)}else alert("Êé•ÂèóÈÇÄË´ãÂ§±Êïó")}catch(e){console.error("Accept invite error:",e)}}async function el(e){try{await (0,l.api)(`/api/friends/reject-battle-invite/${e}`,{method:"POST"}),L(s=>s.filter(s=>s.id!==e))}catch(e){console.error("Reject invite error:",e)}}async function er(){try{localStorage.getItem("token")&&await (0,l.api)("/api/users/logout",{method:"POST"})}catch(e){console.error("Logout error:",e)}finally{localStorage.removeItem("token"),localStorage.removeItem("user"),e.replace("/")}}function en(e){j(e),localStorage.setItem("user",JSON.stringify(e))}async function ei(e){try{let s=await (0,l.api)(`/api/friends/user/${e}`);s.ok&&(Z(await s.json()),S(!0))}catch(e){console.error("Failed to fetch user detail:",e)}}async function ec(e){try{let s=await (0,l.api)(`/api/friends/add-friend/${e}`,{method:"POST"});if(s.ok){alert("Â•ΩÂèãË´ãÊ±ÇÂ∑≤ÁôºÈÄÅÔºÅ");let e=await (0,l.api)("/api/friends/online-users");e.ok&&E(await e.json())}else{let e=await s.json();alert(e.error||"ÁôºÈÄÅÂ§±Êïó")}}catch(e){console.error("Failed to send friend request:",e)}}async function ed(e){try{if((await (0,l.api)(`/api/friends/accept-friend/${e}`,{method:"POST"})).ok){let[e,s,t]=await Promise.all([(0,l.api)("/api/friends/my-friends"),(0,l.api)("/api/friends/pending-requests"),(0,l.api)("/api/friends/online-users")]);e.ok&&F(await e.json()),s.ok&&q(await s.json()),t.ok&&E(await t.json())}}catch(e){console.error("Failed to accept friend request:",e)}}async function eo(e){try{if((await (0,l.api)(`/api/friends/reject-friend/${e}`,{method:"DELETE"})).ok){let e=await (0,l.api)("/api/friends/pending-requests");e.ok&&q(await e.json())}}catch(e){console.error("Failed to reject friend request:",e)}}async function ex(e){if(confirm("Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄô‰ΩçÂ•ΩÂèãÂóéÔºü"))try{if((await (0,l.api)(`/api/friends/remove-friend/${e}`,{method:"DELETE"})).ok){let s=await (0,l.api)("/api/friends/my-friends");s.ok&&F(await s.json()),U&&U.id===e&&(R(!1),B(null))}}catch(e){console.error("Failed to remove friend:",e)}}async function em(s){try{let t;V(!0),K(s),W("waiting");let a=await (0,l.api)("/api/matchmaking/queue/join",{method:"POST",body:JSON.stringify({mode:s})});if(!a.ok)throw Error("Failed to join queue");let r=await a.json();"matched"===r.status?(W("matched"),X(r.battleId),ee(r.opponent),setTimeout(()=>e.push(`/battle?id=${r.battleId}`),3e3)):(t=setInterval(async()=>{try{let s=await (0,l.api)("/api/matchmaking/queue/status");if(!s.ok)return void clearInterval(t);let a=await s.json();"matched"===a.status&&(clearInterval(t),W("matched"),X(a.battleId),ee(a.opponent),setTimeout(()=>e.push(`/battle?id=${a.battleId}`),3e3))}catch(e){console.error("Error polling match status:",e),clearInterval(t)}},2e3),window.matchPollInterval=t)}catch(e){console.error("Failed to start matching:",e),V(!1),K(null),W(null),alert("ÂåπÈÖçÂ§±ÊïóÔºåË´ãÈáçË©¶")}}async function eh(){try{await (0,l.api)("/api/matchmaking/queue/leave",{method:"POST"}),window.matchPollInterval&&clearInterval(window.matchPollInterval),V(!1),K(null),W(null)}catch(e){console.error("Failed to cancel matching:",e)}}async function ep(e){try{if((await (0,l.api)(`/api/friends/add-friend/${e}`,{method:"POST"})).ok){alert("Â•ΩÂèãË´ãÊ±ÇÂ∑≤ÁôºÈÄÅÔºÅ");let s=await (0,l.api)("/api/friends/pending-requests");s.ok&&q(await s.json()),D&&D.id===e&&ei(e)}}catch(e){console.error("Failed to add friend:",e)}}return(0,t.useEffect)(()=>{if(localStorage.getItem("token")){let e=localStorage.getItem("user");e&&j(JSON.parse(e)),(0,l.api)("/api/users/me").then(e=>{if(e.ok)return e.json();throw Error("Failed to fetch user")}).then(e=>{j(e),localStorage.setItem("user",JSON.stringify(e))}).catch(e=>{console.error(e)}).finally(()=>{c(!1)})}else e.replace("/")},[e]),(0,t.useEffect)(()=>{if(!localStorage.getItem("token"))return;(0,l.api)("/api/friends/ping",{method:"POST"});let e=setInterval(()=>{(0,l.api)("/api/friends/ping",{method:"POST"})},2e4);return()=>clearInterval(e)},[]),(0,t.useEffect)(()=>{if(!f)return;async function e(){try{let[e,s,t,a]=await Promise.all([(0,l.api)("/api/friends/my-friends"),(0,l.api)("/api/friends/online-users"),(0,l.api)("/api/friends/pending-requests"),(0,l.api)("/api/friends/battle-invites")]);e.ok&&F(await e.json()),s.ok&&E(await s.json()),t.ok&&q(await t.json()),a.ok&&L(await a.json())}catch(e){console.error("Failed to load friends and users:",e)}}e();let s=setInterval(e,3e4);return()=>clearInterval(s)},[f]),n?(0,s.jsx)("div",{className:"min-h-screen bg-[#0f172a] flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})}):(0,s.jsxs)("div",{className:"flex flex-col h-screen bg-[#0f172a] text-slate-200 overflow-hidden",children:[(0,s.jsx)(i,{friendRequestsCount:M.length+z.length,showFriendRequests:I,setShowFriendRequests:C,handleLogout:er,onOpenLeaderboard:()=>T(!0)}),(0,s.jsxs)("main",{className:"flex flex-1 overflow-hidden",children:[(0,s.jsx)(d,{user:f,selectedAvatar:es,setShowAvatarPicker:w,openProfileEdit:function(){_(!0)},startMatching:em,isMatching:J}),(0,s.jsx)(x,{user:f}),(0,s.jsx)(o,{friends:P,onlineUsers:A,openChat:function(e){B(e),R(!0)},viewUserDetail:ei,removeFriend:ex,sendFriendRequest:ec})]}),(0,s.jsx)(m,{showAvatarPicker:N,setShowAvatarPicker:w,currentAvatar:es,onUpdate:en}),(0,s.jsx)(h,{showProfileEdit:y,setShowProfileEdit:_,user:f,onUpdate:en}),(0,s.jsx)(p,{showUserDetail:k,setShowUserDetail:S,selectedUser:D,addFriend:ep,removeFriend:ex,onChallenge:et}),(0,s.jsx)(u,{showFriendRequests:I,setShowFriendRequests:C,friendRequests:M,acceptFriendRequest:ed,rejectFriendRequest:eo,battleInvites:z,acceptBattleInvite:ea,rejectBattleInvite:el}),(0,s.jsx)(b,{showChat:$,setShowChat:R,chatFriend:U,user:f}),(0,s.jsx)(g,{isMatching:J,matchStatus:H,matchMode:G,cancelMatching:eh,opponent:Y}),(0,s.jsx)(v,{show:O,onClose:()=>T(!1)})]})}e.s(["default",()=>_],15452)}]);